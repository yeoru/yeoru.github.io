<!DOCTYPE html>
<html>
<head>
<style>
/* CSS 코드 */
body {
  background-color: rgb(31, 31, 32);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
}

#text-input {
  width: 300px;
  background-color: rgb(228, 228, 228);
  stroke: rgb(31, 31, 32);
  padding: 10px;
  font-size: 16px;
  margin-top: 20px;
}

img {
  max-width: 20%;
  height: auto;
  display: block;
  width: 20%;
  margin: 20px auto;
  border: 1px solid #333;
  border-radius: 5px;
}

#add-button {
  height: 40px;
  background-color: rgb(228, 228, 228);
  color: rgb(255, 255, 255);
  margin-top: 10px;
}

.float-text {
  animation: float 3s infinite;
  position: relative;
  color: rgb(38, 198, 204);
}
</style>
</head>
<body>
<h4>WISH TOWER</h4>
<br>
<img src="https://yeoru.github.io/static/wishtower.png" alt="wishtower">

<input type="text" id="text-input" placeholder="당신이 현재 강력히 원하는 것은 무엇인가요?">
<button id="add-button">입력</button>
<br><br>
<div id="floating-text-container"></div>

<script type="module">
// Firebase SDK 모듈 가져오기
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";

// Firebase 구성 정보
const firebaseConfig = {
  apiKey: "AIzaSyCe2XkYA_z_GRBc-iIC2joBGj6fiXIstEk",
  authDomain: "wish-tower.firebaseapp.com",
  databaseURL: "https://wish-tower-default-rtdb.firebaseio.com",
  projectId: "wish-tower",
  storageBucket: "wish-tower.appspot.com",
  messagingSenderId: "981933719218",
  appId: "1:981933719218:web:4df6e9c805529699a3d3ab",
  measurementId: "G-MBR0999ZZP"
};

// Firebase 초기화
const app = initializeApp(firebaseConfig);
const database = getDatabase(app);

// 저장된 텍스트 데이터를 가져와 화면에 표시하는 함수
function displaySavedTexts() {
  const messagesRef = ref(database, 'messages');
  onValue(messagesRef, (snapshot) => {
    const floatingTextContainer = document.getElementById("floating-text-container");
    floatingTextContainer.innerHTML = ""; // 기존 내용 초기화
    snapshot.forEach((childSnapshot) => {
      const text = childSnapshot.val();
      const newTextElement = document.createElement("div");
      newTextElement.className = "float-text";
      newTextElement.innerText = text;
      floatingTextContainer.appendChild(newTextElement);
    });
  });
}

// 서버로 텍스트 데이터를 전송하고 화면에 표시하는 함수
function addFloatingText() {
  const textInput = document.getElementById("text-input");
  const text = textInput.value;

  if (text) {
    // Firebase Realtime Database에 데이터 저장
    const messagesRef = ref(database, 'messages');
    push(messagesRef, text).then(() => {
      // 입력 필드 초기화
      textInput.value = "";
    }).catch(error => {
      console.error("저장 중 오류 발생:", error);
    });
  } else {
    alert("소원을 입력하세요!");
  }
}

// 이벤트 리스너를 통해 버튼 클릭 시 함수 호출
document.getElementById("add-button").addEventListener("click", addFloatingText);

// 페이지가 로드될 때 저장된 텍스트를 불러와 표시
displaySavedTexts();
</script>
</body>
</html>
